<h2>Austen Word Frequency Form Test</h2>

<ul class="nav nav-tabs" role="tablist">
  <li role="presentation" class="active">
    <a href="#one" aria-controls="home" role="tab" data-toggle="tab">Pride and Prejudice</a>
  </li>
  <li role="presentation">
    <a href="#two" aria-controls="settings" role="tab" data-toggle="tab">Persuasion</a>
  </li>
  <li role="presentation">
    <a href="#three" aria-controls="messages" role="tab" data-toggle="tab">Northanger Abbey</a>
  </li>
  <li role="presentation">
    <a href="#four" aria-controls="settings" role="tab" data-toggle="tab">Sense and Sensibility</a>
  </li>
  <li role="presentation">
    <a href="#five" aria-controls="settings" role="tab" data-toggle="tab">Emma</a>
  </li>
  <li role="presentation">
    <a href="#six" aria-controls="profile" role="tab" data-toggle="tab">Mansfield Park</a>
  </li>
</ul>

<div class="tab-content">

  <div class="tab-pane active" id="one" role="tabpanel">
    <%= render :partial => "pride_and_prejudice" %>
  </div>

  <div role="tabpanel" class="tab-pane" id="two">
    <%= render :partial => "persuasion" %>
  </div>
  <div role="tabpanel" class="tab-pane" id="three">
    <%= render :partial => "northanger_abbey" %>
  </div>
  <div role="tabpanel" class="tab-pane" id="four">
    <%= render :partial => "sense_and_sensibility" %>
  </div>
  <div role="tabpanel" class="tab-pane" id="five">
    <%= render :partial => "emma" %>
  </div>
  <div role="tabpanel" class="tab-pane" id="six">
    <%= render :partial => "mansfield_park" %>
  </div>


    <script>
      $(document).ready(function() {
        var container = $(".text-display-container");
        var textarea_num = 0;
        var max_textareas = 3;
        $(".btn").click(function() {
          var name = $(this).text();
          var id = $(this).attr("href").replace("#", "");
          var novel = $(this).attr("data");
          var heading = novel.replace("_", " ") + " " + id;
          getJson(novel, id, function(data) {
            if (data) {
              removeExtraTextareas(function() {
                var textarea = newTextArea(textarea_num, heading, data).hide();
                container.append(textarea);
                textarea.show(600);
                textarea_num++;
              });
            } else {
              console.log("No information found for that person");
            }
          }, function(error) {
            console.log("checking that this error works " + error["status"]);
          });
        });

        function getJson(novel, id, onSuccess, onFailure) {
          $.ajax({
            // TODO get the actual url
            url: "frequencies/"+novel+"/"+id,
            type: "GET",
            dataType: "json",
            success: function(data, textStatus, xhr) {
              onSuccess(data);
            },
            error: function(error) {
              onFailure(error)
            }
          });
        };

        function removeExtraTextareas(onRemoved) {
          var things = $(".frequency_text");
          if (things.length >= max_textareas ) {
            things.first().hide(600, function() {
              things.first().remove();
              onRemoved();
            });
          } else {
            onRemoved();
          }
        };

        // this should be pulled eventually from actual information
        // but for now using a placeholder as a ui proof of concept
        function newTextArea(number, heading, data) {
          var textarea = $('<textarea id="textarea_'+number+'" class="frequency_text" readonly=true rows=12></textarea>');
          var text = heading + "\n";
          text += "Unique words: " + data["unique_words"] + "\n";
          text += "All speeches: " + data["speeches"] + "\n";
          for (var key in data["words"]) {
            text += key + ": " + data["words"][key] + "\n";
          }
          textarea.append(text);
          return textarea;
        };
      });
    </script>

    <h3>Austen Frequency Stuff</h3>
    <div class="text-display-container">
    </div>
  </div>